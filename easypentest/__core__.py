import os
import subprocess
import random
import sys

from colorama import init

init(strip=not sys.stdout.isatty())  # strip colors if stdout is redirected
from termcolor import cprint
from pyfiglet import figlet_format


def banner():
    colors = ["red", "green", "blue", "cyan", "yellow"]
    cprint(figlet_format('easypentest', font="digital", width=50), random.choice(colors), None)


def run_file(file_path):
    with open(file_path, "r") as file:
        exec(file.read())


def set_text_color(color):
    colors = {
        "black": "30",
        "red": "31",
        "green": "32",
        "yellow": "33",
        "blue": "34",
        "magenta": "35",
        "cyan": "36",
        "white": "37"
    }
    if color in colors:
        print("\033[1;" + colors[color] + ";40m", end="")
    else:
        print("Invalid color. Please choose from: ", end="")
        for key in colors.keys():
            print(key, end=", ")
        print("\033[0;37;40m", end="")


def print_menu(options):
    for i, option in enumerate(options):
        set_text_color("red")
        print(f"{i + 1}. {option}")


def create_menu():
    frameworks_folder = "frameworks"
    files = [f for f in os.listdir(frameworks_folder) if f.endswith(".py") and not f.startswith("__init__")]
    menu_options = []
    for i, file in enumerate(files):
        menu_options.append(f"{i + 1}. {file.replace('.py', '')}")
    print("\n".join(menu_options))
    selected_option = int(input("Enter your selection: ")) - 1
    selected_file = files[selected_option]
    exec(open(os.path.join(frameworks_folder, selected_file)).read())




def run_package(package_name):
    try:
        import importlib
        importlib.import_module(package_name)
    except ImportError:
        subprocess.run(["python3", "-m", "pip", "install", package_name])
        import importlib
        importlib.import_module(package_name)

    subprocess.run([package_name], shell=True)